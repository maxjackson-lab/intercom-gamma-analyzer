# Railway MCP Integration Guide

**Purpose:** Enable easy file reading from Railway via MCP or CLI for debugging and analysis.

---

## Overview

Files generated by the Intercom Analysis Tool are saved to:
- **Web executions:** `/app/outputs/executions/<execution_id>/`
- **CLI executions:** `outputs/`
- **Persistent volume:** `/mnt/persistent/outputs/executions/<execution_id>/` (if configured)

All files are:
- ✅ **UTF-8 encoded** for proper character support
- ✅ **Human-readable** (JSON with indentation, plain text logs)
- ✅ **Accessible via Railway Files tab** in browser
- ✅ **Accessible via Railway CLI** (`railway run cat ...`)
- ✅ **Accessible via web API** (`/api/browse-files`, `/outputs/{file_path}`)

---

## File Types Generated

### 1. Analysis Results
- **JSON files:** `sample_mode_*.json`, `voice_of_customer_*.json`
  - Structured data with metadata, conversations, topics, etc.
  - Pretty-printed with `indent=2` and `ensure_ascii=False`
  
### 2. Log Files
- **Text logs:** `*.log` files
  - Complete console output (captures everything even if SSE disconnects)
  - UTF-8 encoded for proper character display
  
### 3. Observability Data
- **Metrics JSON:** `agent_metrics_*.json`
  - LLM call metrics, error counts, timeout rates
  - Structured for easy analysis

### 4. Agent Thinking Logs
- **Thinking logs:** `agent_thinking_*.log`
  - Detailed agent reasoning and LLM interactions
  - Human-readable format with timestamps

---

## Access Methods

### Method 1: Railway CLI (Recommended for MCP Integration)

```bash
# List files in latest execution
railway run ls -la /app/outputs/executions/

# Read specific file
railway run cat /app/outputs/executions/sample-mode_Last-Week_Nov-13-5-27pm/sample_mode_Nov-13-2025_05-27PM.json

# Read log file (first 100 lines)
railway run head -100 /app/outputs/executions/*/voice_of_customer_*.log

# Find all JSON files
railway run find /app/outputs -name "*.json" -type f
```

### Method 2: Railway MCP Helper Script

```bash
# List all files in latest execution
railway run python scripts/railway_mcp_helper.py list-files

# Read latest execution files (summary)
railway run python scripts/railway_mcp_helper.py read-latest

# Read specific file
railway run python scripts/railway_mcp_helper.py read-file outputs/executions/sample-mode_Last-Week_Nov-13-5-27pm/sample_mode_Nov-13-2025_05-27PM.json
```

### Method 3: Web API Endpoints

```bash
# Browse all files
curl https://your-railway-app.railway.app/api/browse-files

# Serve specific file
curl https://your-railway-app.railway.app/outputs/executions/sample-mode_Last-Week_Nov-13-5-27pm/sample_mode_Nov-13-2025_05-27PM.json
```

### Method 4: Railway Files Tab (Browser)

1. Go to Railway dashboard → Your project
2. Click on your service
3. Go to **Files** tab
4. Navigate to `/app/outputs/executions/`
5. Click on execution directory
6. Download or view files directly

---

## MCP Integration (Future Enhancement)

**Current Status:** Railway MCP doesn't have direct file reading capabilities, but you can use:

1. **Railway CLI via MCP:** Use `railway run` commands through MCP
2. **Web API:** Call `/api/browse-files` and `/outputs/{file_path}` endpoints
3. **Helper Script:** Use `railway_mcp_helper.py` for structured file access

**Proposed Enhancement:**
- Add Railway MCP function: `read_file(workspace_path, file_path)`
- Add Railway MCP function: `list_files(workspace_path, directory)`
- Integrate with existing `railway_mcp_helper.py` script

---

## File Reading Workflow

### For Debugging (Error-Log-First Approach)

1. **Identify execution ID** from console output or Railway dashboard
2. **Read log file first** (contains complete error tracebacks):
   ```bash
   railway run cat /app/outputs/executions/<execution_id>/*.log
   ```
3. **Read observability JSON** (structured error data):
   ```bash
   railway run cat /app/outputs/executions/<execution_id>/agent_metrics_*.json
   ```
4. **Read analysis results** (if needed):
   ```bash
   railway run cat /app/outputs/executions/<execution_id>/sample_mode_*.json
   ```

### For Analysis

1. **List all files**:
   ```bash
   railway run python scripts/railway_mcp_helper.py list-files
   ```
2. **Read latest execution**:
   ```bash
   railway run python scripts/railway_mcp_helper.py read-latest
   ```
3. **Read specific file**:
   ```bash
   railway run python scripts/railway_mcp_helper.py read-file <file_path>
   ```

---

## File Format Details

### JSON Files
- **Encoding:** UTF-8
- **Indentation:** 2 spaces
- **Unicode:** `ensure_ascii=False` (preserves emojis, special characters)
- **Pretty-printed:** Human-readable structure

### Log Files
- **Encoding:** UTF-8
- **Format:** Plain text with timestamps
- **Content:** Complete console output (Rich console export)

### Example JSON Structure

```json
{
  "metadata": {
    "count": 50,
    "timestamp": "2025-11-19T00:34:33.728235",
    "date_range": {
      "start": "2025-11-12T00:00:00",
      "end": "2025-11-19T00:00:00"
    }
  },
  "conversations": [...],
  "topics": {...}
}
```

---

## Troubleshooting

### Files Not Visible in Browser

1. **Check file location:**
   ```bash
   railway run ls -la /app/outputs/executions/
   ```

2. **Verify execution ID:**
   - Check console output for execution ID
   - Files should be in `outputs/executions/<execution_id>/`

3. **Check permissions:**
   ```bash
   railway run ls -la /app/outputs/executions/<execution_id>/
   ```

### Files Not Readable

1. **Verify encoding:**
   ```bash
   railway run file -i /app/outputs/executions/<execution_id>/*.json
   ```
   Should show: `charset=utf-8`

2. **Check file size:**
   ```bash
   railway run ls -lh /app/outputs/executions/<execution_id>/
   ```

3. **Read with helper script:**
   ```bash
   railway run python scripts/railway_mcp_helper.py read-file <file_path>
   ```

---

## Best Practices

1. **Always read logs first** when debugging (error-log-first approach)
2. **Use helper script** for structured file access
3. **Check file encoding** if characters appear corrupted
4. **Use Railway Files tab** for quick browser access
5. **Use Railway CLI** for programmatic access (MCP integration)

---

## Future Enhancements

- [ ] Add Railway MCP functions for direct file reading
- [ ] Add file search/filter capabilities
- [ ] Add file comparison utilities
- [ ] Add automatic file cleanup (old executions)
- [ ] Add file compression for large outputs

